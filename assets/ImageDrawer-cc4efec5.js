import{r as h}from"./index-bcc64600.js";import{drawGif as f}from"./Utils-ada55b1e.js";import{am as d}from"./index-0376d268.js";const c=2,p=1,u=12,_=1;class y{constructor(o){this.loadImageShape=async e=>{if(!this._engine.loadImage)throw new Error(`${d} image shape not initialized`);await this._engine.loadImage({gif:e.gif,name:e.name,replaceColor:e.replaceColor??!1,src:e.src})},this._engine=o}addImage(o){this._engine.images||(this._engine.images=[]),this._engine.images.push(o)}draw(o){const{context:e,radius:t,particle:i,opacity:n}=o,a=i.image,r=a==null?void 0:a.element;if(a){if(e.globalAlpha=n,a.gif&&a.gifData)f(o);else if(r){const s=a.ratio,g={x:-t,y:-t},l=t*c;e.drawImage(r,g.x,g.y,l,l/s)}e.globalAlpha=p}}getSidesCount(){return u}async init(o){const e=o.actualOptions;if(!(!e.preload||!this._engine.loadImage))for(const t of e.preload)await this._engine.loadImage(t)}loadShape(o){if(o.shape!=="image"&&o.shape!=="images")return;this._engine.images||(this._engine.images=[]);const e=o.shapeData;if(!e)return;this._engine.images.find(i=>i.name===e.name||i.source===e.src)||this.loadImageShape(e).then(()=>{this.loadShape(o)})}particleInit(o,e){if(e.shape!=="image"&&e.shape!=="images")return;this._engine.images||(this._engine.images=[]);const t=this._engine.images,i=e.shapeData;if(!i)return;const n=e.getFillColor(),a=t.find(s=>s.name===i.name||s.source===i.src);if(!a)return;const r=i.replaceColor??a.replaceColor;if(a.loading){setTimeout(()=>{this.particleInit(o,e)});return}(async()=>{let s;a.svgData&&n?s=await h(a,i,n,e):s={color:n,data:a,element:a.element,gif:a.gif,gifData:a.gifData,gifLoopCount:a.gifLoopCount,loaded:!0,ratio:i.width&&i.height?i.width/i.height:a.ratio??_,replaceColor:r,source:i.src},s.ratio||(s.ratio=1);const g=i.fill??e.shapeFill,l=i.close??e.shapeClose,m={image:s,fill:g,close:l};e.image=m.image,e.shapeFill=m.fill,e.shapeClose=m.close})()}}export{y as ImageDrawer};
